<!DOCTYPE html>
<html>
  <meta charset="UTF-8" ; />
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    let baseUrl = "http://localhost:<%= port %>/<%= backendPath %>";
    let closeTimeoutSec = "<%= windowCloseTimeoutSec %>";
    let contents = `
        <p>ターミナルに結果を表示しています。</p>
        <p>このタブは${closeTimeoutSec}秒後に自動的に閉じます。</p>
    `;

    function onResponse(response) {
      document.write(contents);
      setTimeout(function () {
        window.close();
      }, closeTimeoutSec * 1000);
    }

    function main() {
      let url =
        baseUrl + "?callback_url=" + encodeURIComponent(window.location.href);
      axios
        .get(url)
        .then(function (response) {
          onResponse(response);
        })
        .catch(function (error) {
          onResponse(response);
        });
    }

    window.onload = main;
  </script>
</html>
